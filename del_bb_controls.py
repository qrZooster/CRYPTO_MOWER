# ======================================================================================================================
# üìÅ file        : bb_controls.py ‚Äî –≤–∏–∑—É–∞–ª—å–Ω–∞—è –≤–µ—Ç–≤—å Tradition Core 2025 (UI-–∫–æ–Ω—Ç—Ä–æ–ª—ã –∏ —Ä–µ–Ω–¥–µ—Ä)
# üïí created     : 17.10.2025 12:31
# üéâ contains    : TCustomControl, TControl, TForm, TPage
# üåÖ project     : Tradition Core 2025 üúÇ
# ======================================================================================================================
# üö¢ ...imports...
from __future__ import annotations
import hashlib
import base64
import re
from typing import Optional, Dict, Any
from bb_sys import *
from bb_ctrl_custom import TCustomControl, TControl, TFlex_Tr, TFlex_Td
from datetime import datetime
# üíéüß©‚öôÔ∏è ... __ALL__ ...
__all__ = ["TGrid", "TPanel", "TCard"]
# ----------------------------------------------------------------------------------------------------------------------
# üß© TGrid ‚Äî –∫–∞—Ä–∫–∞—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã / —Å–µ–∫—Ü–∏–∏ (flex-column –∏–∑ —Å—Ç—Ä–æ–∫)
# ----------------------------------------------------------------------------------------------------------------------
class TGrid(TControl):
    prefix = "grid"
    MARK_FAMILY = "grid"
    MARK_LEVEL = 0

    def __init__(self, Owner: TOwnerObject | None = None, Name: str | None = None):
        """
        –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç—Ä–æ–∫ –≥—Ä–∏–¥–∞ (flex-–∫–∞—Ä–∫–∞—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã / –ø–∞–Ω–µ–ª–∏).

        –î–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã ‚Äî —ç—Ç–æ TGrid_Tr (—Å—Ç—Ä–æ–∫–∏).
        –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–∞–º–∞ —è–≤–ª—è–µ—Ç—Å—è flex-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –∏ —Ö—Ä–∞–Ω–∏—Ç TGrid_Td.

        –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≥—Ä–∏–¥ ‚Äî —ç—Ç–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü —Å—Ç—Ä–æ–∫:
            flex-direction: column;
            gap: 1rem;
            width: 100%;
            height: 100%;

        –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–∂–Ω–æ –ø—Ä–∞–≤–∏—Ç—å:
            .direction ('row'/'column')
            .border (–µ—Å–ª–∏ –Ω–∞–¥–æ –æ—Ç–¥–µ–±–∞–∂–∏—Ç—å —Ä–∞–º–∫–æ–π)
        """
        super().__init__(Owner, Name)

        # --- –ì–µ–æ–º–µ—Ç—Ä–∏—è –≥—Ä–∏–¥–∞ ---
        self.direction: str = "column"          # –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ flex-–ø–æ—Ç–æ–∫–∞
        self.Rows: list["TGrid_Tr"] = []        # —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä —Å—Ç—Ä–æ–∫ (TGrid_Tr)

        # –î–µ–ª–∞–µ–º —Å–∞–º –≥—Ä–∏–¥ flex-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º (–∫–æ–ª–æ–Ω–∫–∞ —Å—Ç—Ä–æ–∫)
        self.flex_box(
            direction=self.direction,
            gap="1rem",
            width="100%",
            height="100%",
        )

        # –µ—Å–ª–∏ —Å–Ω–∞—Ä—É–∂–∏ –∫—Ç–æ-—Ç–æ –ø–æ—Å—Ç–∞–≤–∏–ª grid.border = "2px dashed lime"
        if getattr(self, "border", None):
            self.add_style(f"border:{self.border};")

        self.log("__init__", f"‚öôÔ∏è grid {self.Name} created dir={self.direction}")

    # ..................................................................................................................
    # üß± –°—Ç—Ä–æ–∫–∏ –∏ —è—á–µ–π–∫–∏ –≥—Ä–∏–¥–∞
    # ..................................................................................................................
    def tr(self, index: int | None = None) -> "TGrid_Tr | None":
        """
        –î–æ—Å—Ç—É–ø –∫ —Å—Ç—Ä–æ–∫–µ –≥—Ä–∏–¥–∞.

        grid.tr()            ‚Üí —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é TGrid_Tr(Owner=self), –ø—É—à–∏—Ç –≤ Rows –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ—ë.
        grid.tr(-1) / tr(i)  ‚Üí –≤–µ—Ä–Ω—É—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∏–ª–∏ i-—É—é —Å—Ç—Ä–æ–∫—É –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è.

        –í–ù–ò–ú–ê–ù–ò–ï:
        - –ö–∞–∂–¥–∞—è –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Å—Ä–∞–∑—É –ø–æ–¥–≤–µ—à–µ–Ω–∞ –∫ —ç—Ç–æ–º—É –≥—Ä–∏–¥—É (Owner=self), —Ç–æ –µ—Å—Ç—å –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤–ª–∞–¥–µ–Ω–∏—è.
        - –õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ-—Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–≤–æ–π —è—á–µ–π–∫–∏ —É —Å—Ç—Ä–æ–∫–∏ (td0) –∂–∏–≤—ë—Ç —É–∂–µ –≤–Ω—É—Ç—Ä–∏ —Å–∞–º–æ–π —Å—Ç—Ä–æ–∫–∏ TGrid_Tr (—Ñ–∞–∑–∞ –ø–æ–∑–∂–µ).
        """
        if index is None:
            row = TGrid_Tr(self)
            self.Rows.append(row)
            return row
        try:
            if index == -1:
                return self.Rows[-1]
            return self.Rows[index]
        except IndexError:
            return None

    def td(self, row_index: int, cell_index: int | None = None) -> "TGrid_Td | None":
        """
        –£–¥–æ–±–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —è—á–µ–π–∫–µ.

        grid.td(r)        ‚Üí —Å–æ–∑–¥–∞—ë—Ç/–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤—É—é —Å–≤–æ–±–æ–¥–Ω—É—é —è—á–µ–π–∫—É —Å—Ç—Ä–æ–∫–∏ r.
        grid.td(r, c)     ‚Üí –≤–µ—Ä–Ω—É—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —è—á–µ–π–∫—É c —Å—Ç—Ä–æ–∫–∏ r.

        –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ç—Ä–æ–∫–µ:
            row = grid.tr(r)
            row.td(c)
        """
        row = self.tr(row_index)
        if not row:
            return None
        return row.td(cell_index)

    # ..................................................................................................................
    # üé® –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≥—Ä–∏–¥–∞
    # ..................................................................................................................
    def render(self):
        """
        –†–µ–Ω–¥–µ—Ä–∏–º —Å—Ç—Ä–æ–∫–∏ –≥—Ä–∏–¥–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É.
        –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–∞–º–∞:
            - –æ—Ç–∫—Ä–æ–µ—Ç —Å–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–µ—Ä–µ–∑ _render()
            - –æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏—Ç —Å–≤–æ–∏ TGrid_Td
        –ó–¥–µ—Å—å –º—ã –ø—Ä–æ—Å—Ç–æ –≤–ª–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ç—Ä–æ–∫ –≤ Canvas –≥—Ä–∏–¥–∞.
        """
        for row in self.Rows:
            row._render()
            self.Canvas.extend(row.Canvas)
    # ..................................................................................................................
    # üî∞ mark* (–ø–æ–¥—Å–≤–µ—Ç–∫–∞ debug-—Å–µ–º–µ–π—Å—Ç–≤–∞)
    # ..................................................................................................................
    def _mark_family(self) -> str | None:
        return "grid"

    def _mark_level(self) -> int:
        return 0

    # ..................................................................................................................
    # üõ°Ô∏è PHASE 2: –ø–æ–ª–∏—Ç–∏–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è
    # ..................................................................................................................
    def _owner_required(self) -> bool:
        """
        –ì—Ä–∏–¥ –Ω–µ –¥–æ–ª–∂–µ–Ω –∂–∏—Ç—å –≤ –≤–∞–∫—É—É–º–µ.
        TGrid –≤—Å–µ–≥–¥–∞ —á–∞—Å—Ç—å —á–µ–≥–æ-—Ç–æ –±–æ–ª—å—à–µ–≥–æ:
        - —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        - –∫–∞—Ä—Ç–æ—á–∫–∏
        - td –ø–∞–Ω–µ–ª–∏
        - td –≥—Ä–∏–¥–∞
        –∏ —Ç.–¥.
        """
        return True

    def _allowed_owner_types(self) -> tuple[type, ...] | None:
        """
        –ö—Ç–æ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –±—ã—Ç—å Owner –¥–ª—è TGrid?

        –ò–¥–µ—è: –≥—Ä–∏–¥ ‚Äî —ç—Ç–æ –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è —Ä–∞–∑–º–µ—Ç–∫–∏.
        –û–Ω –º–æ–∂–µ—Ç –≤–∏—Å–µ—Ç—å –Ω–∞ –ª—é–±–æ–º –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ,
        —Ç–æ –µ—Å—Ç—å –Ω–∞ –ª—é–±–æ–º –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–µ TCustomControl.

        –≠—Ç–æ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç —Å–ª—É—á–∞–∏:
          - Page1 (TPage)        ‚Üí Grid1
          - Grid_Td3 (TGrid_Td)  ‚Üí Grid2
          - Panel1 (TPanel)      ‚Üí Grid3
          - CardBody (–≤–Ω—É—Ç—Ä–∏ TCard) ‚Üí Grid4
        """
        return (TCustomControl,)

    def _allowed_child_types(self) -> tuple[type, ...] | None:
        """
        –ö–æ–≥–æ –º—ã —Å—á–∏—Ç–∞–µ–º –∑–∞–∫–æ–Ω–Ω—ã–º–∏ –¥–µ—Ç—å–º–∏ –≥—Ä–∏–¥–∞?

        –ë–∞–∑–æ–≤–æ ‚Äî —Å—Ç—Ä–æ–∫–∏ –≥—Ä–∏–¥–∞ (TGrid_Tr).
        –ù–æ:
        - –Ω–∞ —Ä–∞–Ω–Ω–∏—Ö —Å—Ç–∞–¥–∏—è—Ö –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–≤–µ–ª–æ–ø–µ—Ä –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å
              lbl = TLabel(grid)
          (crazy mode),
          –∏ –º—ã –ø–æ—Ç–æ–º "–ø–µ—Ä–µ—Å–∞–¥–∏–º" —ç—Ç–æ—Ç lbl –≤ –Ω—É–∂–Ω—É—é td –≤–Ω—É—Ç—Ä–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–∏.
          –ß—Ç–æ–±—ã –Ω–µ –ø–∞–¥–∞—Ç—å —Ä–∞–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, —Ä–∞–∑—Ä–µ—à–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ –∏ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã.

        –ü–æ—ç—Ç–æ–º—É –ø–æ–∫–∞:
          ‚Ä¢ TGrid_Tr   ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
          ‚Ä¢ TCustomControl ‚Äî –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ
                              –ø–æ–≤–µ—à–µ–Ω—ã –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ –≥—Ä–∏–¥ –∏ –∑–∞—Ç–µ–º –±—É–¥—É—Ç –ø–µ—Ä–µ—Å–∞–∂–µ–Ω—ã
                              –≤ grid.tr(-1).td(-1) (—ç—Ç–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–¥—ë—Ç –Ω–∞ PHASE 3/4).
        """
        return (TGrid_Tr, TCustomControl)
# ----------------------------------------------------------------------------------------------------------------------
# üß© TGrid_Tr ‚Äî —Å—Ç—Ä–æ–∫–∞ –≥—Ä–∏–¥–∞ (—Ç–æ–Ω–∫–∏–π –Ω–∞—Å–ª–µ–¥–Ω–∏–∫ TFlex_Tr)
# ----------------------------------------------------------------------------------------------------------------------
class TGrid_Tr(TFlex_Tr):
    prefix = "grid_tr"
    MARK_FAMILY = "grid"
    MARK_LEVEL = 1
    # ‚ö°üõ†Ô∏è ‚ñ∏ __init__
    def __init__(self, Owner: TOwnerObject | None = None, Name: str | None = None):
        """
        –°—Ç—Ä–æ–∫–∞ –≥—Ä–∏–¥–∞. –ù–∞—Å–ª–µ–¥—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∫—É TFlex_Tr (flex-row, width:100%, height:auto).
        –û—Å—Ç–∞–≤–ª—è–µ–º –≥—Ä–∏–¥-—Å–ø–µ—Ü–∏—Ñ–∏–∫—É: –≤—ã—Å–æ—Ç–∞ –∏ —Å—Ç—Ä–æ–≥–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è.
        –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–π –≤ –ø–æ—Ç–æ–º–∫–∞—Ö.
        """
        super().__init__(Owner, Name)
        # --- –ì–µ–æ–º–µ—Ç—Ä–∏—è —Å—Ç—Ä–æ–∫–∏ ---
        self.height: str = "auto"
        if self.height and self.height != "auto":
            self.add_style(f"height:{self.height};")
        # ... üîä ...
        self.log("__init__", f"‚öôÔ∏è grid row {self.Name} created height={self.height}")
        # ‚ö°üõ†Ô∏è TGrid_Tr ‚ñ∏ End of __init__

    # ..................................................................................................................
    # üî≥ –†–∞–±–æ—Ç–∞ —Å —è—á–µ–π–∫–∞–º–∏ (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å c API –≥—Ä–∏–¥–∞)
    # ..................................................................................................................
    @property
    def Cells(self) -> list["TGrid_Td"]:
        return self.Tds  # type: ignore[return-value]

    @Cells.setter
    def Cells(self, value: list["TGrid_Td"]) -> None:
        self.Tds = value  # type: ignore[assignment]

    def td(self, index: int | None = None) -> "TGrid_Td | None":
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç/—Å–æ–∑–¥–∞—ë—Ç —è—á–µ–π–∫—É —Å—Ç—Ä–æ–∫–∏.
        row.td()      ‚Üí —Å–æ–∑–¥–∞—ë—Ç TGrid_Td(self), –ø—É—à–∏—Ç –≤ Tds –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç.
        row.td(-1)/i  ‚Üí –≤–µ—Ä–Ω—É—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é/–∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —è—á–µ–π–∫—É –∏–ª–∏ None.
        """
        if index is None:
            cell = TGrid_Td(self)
            self.Tds.append(cell)
            return cell
        try:
            if index == -1:
                return self.Tds[-1]
            return self.Tds[index]
        except IndexError:
            return None

    # ..................................................................................................................
    # üõ°Ô∏è –ü–æ–ª–∏—Ç–∏–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è
    # ..................................................................................................................
    def _owner_required(self) -> bool:
        return True

    def _allowed_owner_types(self) -> tuple[type, ...] | None:
        return (TGrid,)

    def _allowed_child_types(self) -> tuple[type, ...] | None:
        return (TGrid_Td,)
# ----------------------------------------------------------------------------------------------------------------------
# üß© TGrid_Td ‚Äî —è—á–µ–π–∫–∞ –≥—Ä–∏–¥–∞ (—Ç–æ–Ω–∫–∏–π –Ω–∞—Å–ª–µ–¥–Ω–∏–∫ TFlex_Td)
# ----------------------------------------------------------------------------------------------------------------------
class TGrid_Td(TFlex_Td):
    prefix = "grid_td"
    MARK_FAMILY = "grid"
    MARK_LEVEL = 2
    # ‚ö°üõ†Ô∏è ‚ñ∏ __init__
    def __init__(self, Owner: TOwnerObject | None = None, Name: str | None = None):
        """
        –Ø—á–µ–π–∫–∞ —Å—Ç—Ä–æ–∫–∏ –≥—Ä–∏–¥–∞. –ù–∞—Å–ª–µ–¥—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∫—É TFlex_Td (flex-item, flow, —Ä–µ–Ω–¥–µ—Ä).
        –û—Å—Ç–∞–≤–ª—è–µ–º –≥—Ä–∏–¥-—Å–ø–µ—Ü–∏—Ñ–∏–∫—É: width –∏ —Å—Ç—Ä–æ–≥—É—é –ø–æ–ª–∏—Ç–∏–∫—É –≤–ª–∞–¥–µ–Ω–∏—è.
        –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–π –≤ –ø–æ—Ç–æ–º–∫–∞—Ö.
        """
        super().__init__(Owner, Name)
        # --- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã td ---
        self.width: str = "auto"
        # ... üîä ...
        self.log("__init__", f"‚öôÔ∏è grid cell {self.Name} created width={self.width}")
        # ‚ö°üõ†Ô∏è TGrid_Td ‚ñ∏ End of __init__

    # ..................................................................................................................
    # üõ°Ô∏è –ü–æ–ª–∏—Ç–∏–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è
    # ..................................................................................................................
    def _owner_required(self) -> bool:
        return True

    def _allowed_owner_types(self) -> tuple[type, ...] | None:
        return (TGrid_Tr,)

    def _allowed_child_types(self) -> tuple[type, ...] | None:
        return (TCustomControl,)
# ----------------------------------------------------------------------------------------------------------------------
# üß© TPanel ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å (flex-row)
# ----------------------------------------------------------------------------------------------------------------------
class TPanel(TFlex_Tr):
    prefix = "pnl"
    MARK_FAMILY = "panel"
    MARK_LEVEL = 0

    def __init__(self, Owner=None, Name=None):
        """
        –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å (flex-row).

        –í debug_mode:
        - —Å—Ä–∞–∑—É —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ td0;
        - –ø–∞–Ω–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–Ω–∫—É—é —Å–µ—Ä—É—é –ø—É–Ω–∫—Ç–∏—Ä–Ω—É—é —Ä–∞–º–∫—É;
        - –≤ td0 –∫–ª–∞–¥—ë—Ç—Å—è –±–ª–µ–¥–Ω—ã–π –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä —Å self.Name.

        –ö–∞–∫ —Ç–æ–ª—å–∫–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (—á–µ—Ä–µ–∑:
            td = pnl.td(); TLabel(td)   –ò–õ–ò   –ø—Ä–æ—Å—Ç–æ   TLabel(pnl)
        ),
        —Ä–∞–º–∫–∞ –∏ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä —É–±–∏—Ä–∞—é—Ç—Å—è.

        mark() –ø–æ—Ç–æ–º –∫—Ä–∞—Å–∏—Ç –ø–∞–Ω–µ–ª—å –∏ –µ—ë td –∫–∞–∫ —Å–µ–º–µ–π—Å—Ç–≤–æ 'panel'.
        """
        super().__init__(Owner, Name)

        # —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ–∫–æ–ª–æ–Ω–∫–∏ / –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞
        # ‚úÖ td0 —Å–æ–∑–¥–∞—ë—Ç—Å—è –í–°–ï–ì–î–ê –ø—Ä–∏ –∫–æ–Ω—Å—Ç—Ä—É–∏—Ä–æ–≤–∞–Ω–∏–∏
        self._auto_td0: "TFlex_Td | None" = super().td(None)  # –ø–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞
        self._td0_claimed: bool = False                       # True -> td0 —è–≤–Ω–æ –∑–∞–Ω—è—Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
        self._placeholder_active: bool = False                # True -> –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –µ—â—ë –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        self._placeholder_html: str | None = None             # html –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞
        self._placeholder_border_style: str | None = None     # style –¥–ª—è —Ä–∞–º–∫–∏ –ø–∞–Ω–µ–ª–∏

        app = self.app()
        if app and getattr(app, "debug_mode", False):
            self._setup_placeholder()

        self.log("__init__", f"panel {self.Name} created")

    # ..................................................................................................................
    # ü™Ñ Placeholder / debug auto-td0
    # ..................................................................................................................
    def _setup_placeholder(self):
        """
        –ì–æ—Ç–æ–≤–∏—Ç –ø—É–Ω–∫—Ç–∏—Ä–Ω—É—é —Ä–∞–º–∫—É –∏ —Å–µ—Ä—É—é –ø–æ–¥–ø–∏—Å—å (self.Name) –≤–Ω—É—Ç—Ä–∏ —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–π td0.
        –ù—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø–∞–Ω–µ–ª—å –±—ã–ª–∞ –≤–∏–¥–Ω–∞ –¥–∞–∂–µ –ø—É—Å—Ç–æ–π –∏ –±–µ–∑ mark().
        """
        # –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –ø–æ–¥—Å—Ç—Ä–∞—Ö—É–µ–º—Å—è
        if self._auto_td0 is None:
            self._auto_td0 = super().td(None)

        # –ø—É–Ω–∫—Ç–∏—Ä–Ω–∞—è —Ä–∞–º–∫–∞ –≤–æ–∫—Ä—É–≥ –ø–∞–Ω–µ–ª–∏ (—Å–ª–∞–±–∞—è, –ø–æ–∫–∞ –ø–∞–Ω–µ–ª—å –ø—É—Å—Ç–∞—è)
        border_frag = "border:1px dashed rgba(160,160,160,0.6);"
        self.add_style(border_frag)
        self._placeholder_border_style = border_frag

        # —Å–µ—Ä—ã–π —Ç–µ–∫—Å—Ç-–ø–æ–¥—Å–∫–∞–∑–∫–∞ –≤–Ω—É—Ç—Ä–∏ td0
        ph_style = (
            "color:#999;font-size:12px;font-family:monospace;"
            "line-height:1.2;opacity:0.6;"
        )
        self._placeholder_html = f"<div style='{ph_style}'>{self.Name}</div>"

        # –∫–ª–∞–¥—ë–º HTML –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –≤ –ø–æ—Ç–æ–∫ td0, –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤
        if self._auto_td0 is not None:
            self._auto_td0.Flow.append(self._placeholder_html)

        self._placeholder_active = True
        self._td0_claimed = False

    def _disable_placeholder_if_needed(self):
        """
        –£–±–∏—Ä–∞–µ—Ç –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –∏ —Å–µ—Ä—É—é —Ä–∞–º–∫—É, –∫–æ–≥–¥–∞ –ø–∞–Ω–µ–ª—å —Ä–µ–∞–ª—å–Ω–æ –Ω–∞—á–∞–ª–∞ –∂–∏—Ç—å.
        –î–µ–ª–∞–µ–º —ç—Ç–æ —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑.
        """
        if not self._placeholder_active:
            return

        # 1) —É–±–∏—Ä–∞–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä-—Ç–µ–∫—Å—Ç –∏–∑ td0.Flow
        if self._auto_td0:
            new_flow = []
            for node in self._auto_td0.Flow:
                if node is self._placeholder_html:
                    continue
                if node == self._placeholder_html:
                    continue
                new_flow.append(node)
            self._auto_td0.Flow = new_flow

        # 2) —Å–Ω–∏–º–∞–µ–º —Å–µ—Ä—É—é —Ä–∞–º–∫—É —Å –ø–∞–Ω–µ–ª–∏
        if self._placeholder_border_style and self._placeholder_border_style in self.styles:
            try:
                self.styles.remove(self._placeholder_border_style)
            except Exception:
                pass

        self._placeholder_active = False

    # ..................................................................................................................
    # üß± td() —Å "–ø–µ—Ä–≤–æ–π —è—á–µ–π–∫–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"
    # ..................................................................................................................
    def td(self, index: int | None = None) -> "TFlex_Td | None":
        """
        pnl.td() –ø–µ—Ä–≤—ã–π —Ä–∞–∑ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—É—é td0 (–Ω–µ —Å–Ω–∏–º–∞—è –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä —Å–∞–º –ø–æ —Å–µ–±–µ).
        pnl.td() –≤—Ç–æ—Ä–æ–π —Ä–∞–∑ ‚Üí —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –∫–æ–ª–æ–Ω–∫—É (td1, td2, ...).
        td(n)/td(-1)        ‚Üí –æ–±—ã—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞.
        """
        if index is None:
            # –µ—Å–ª–∏ td0 —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –µ—ë –µ—â—ë –Ω–µ "–≤–∑—è–ª–∏" —è–≤–Ω–æ ‚Üí –æ—Ç–¥–∞—ë–º –µ—ë
            if self._auto_td0 is not None and not self._td0_claimed:
                self._td0_claimed = True
                return self._auto_td0
            # –∏–Ω–∞—á–µ —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é –∫–æ–ª–æ–Ω–∫—É —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ
            return super().td(None)

        # –∑–∞–ø—Ä–æ—à–µ–Ω —è–≤–Ω—ã–π –∏–Ω–¥–µ–∫—Å (-1 –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π)
        return super().td(index)

    # ..................................................................................................................
    # üîÅ Child registration hooks
    # ..................................................................................................................
    def _notify_child_content(self, td: "TFlex_Td"):
        """
        –í—ã–∑—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –≤ –ª—é–±—É—é –∫–æ–ª–æ–Ω–∫—É —Ä–µ–∞–ª—å–Ω–æ –¥–æ–±–∞–≤–∏–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª (–ª—é–±–æ–π –Ω–µ-–ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä).
        –≠—Ç–æ —Å–∏–≥–Ω–∞–ª: "–ø–∞–Ω–µ–ª—å –∂–∏–≤–∞—è" ‚Äî —É–±–∏—Ä–∞–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä/—Ä–∞–º–∫—É.
        """
        if td is self._auto_td0:
            self._td0_claimed = True
        self._disable_placeholder_if_needed()

    def add_control(self, ctrl: "TCustomControl"):
        # –µ—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ ‚Äî –æ–±—ã—á–Ω–∞—è –ª–æ–≥–∏–∫–∞
        if isinstance(ctrl, TFlex_Td):
            return super().add_control(ctrl)

        # ‚úÖ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–∏–¥–∞–µ–º –≤ –ü–û–°–õ–ï–î–ù–Æ–Æ —è—á–µ–π–∫—É (td(-1))
        cell = self.td(-1) or super().td(None)

        # —É–±—Ä–∞—Ç—å —Å –ø–∞–Ω–µ–ª–∏ (–ø–µ—Ä–µ—Å–∞–¥–∫–∞ –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π td)
        if ctrl.Name in self.Components:
            del self.Components[ctrl.Name]
        if hasattr(self, "Controls") and ctrl.Name in self.Controls:
            del self.Controls[ctrl.Name]

        # –ø–µ—Ä–µ–ø—Ä–∏–≤—è–∑–∞—Ç—å –∫ –∫–æ–ª–æ–Ω–∫–µ –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ –ø–æ—Ç–æ–∫
        ctrl.Owner = cell
        cell.Components[ctrl.Name] = ctrl
        cell.add_control(ctrl)

        # –ø–∞–Ω–µ–ª—å ¬´–æ–∂–∏–ª–∞¬ª: —Å–Ω–∏–º–∞–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä/—Ä–∞–º–∫—É, –µ—Å–ª–∏ –±—ã–ª–∏
        self._disable_placeholder_if_needed()
        return

    # ..................................................................................................................
    # üî∞ mark* methods
    # ..................................................................................................................
    def _mark_family(self) -> str | None:
        return "panel"

    def _mark_level(self) -> int:
        return 0

    def _child_mark_level(self) -> int:
        """
        –î–ª—è –º–æ–∏—Ö –∫–æ–ª–æ–Ω–æ–∫ (TFlex_Td) —É—Ä–æ–≤–µ–Ω—å = 1,
        —á—Ç–æ–±—ã –æ–Ω–∏ –ø–æ–ª—É—á–∏–ª–∏ –±–æ–ª–µ–µ —è—Ä–∫–∏–π –æ—Ç—Ç–µ–Ω–æ–∫ 'panel'
        —Å–æ–≥–ª–∞—Å–Ω–æ _LEVEL_TO_SHADE["panel"][1] -> "bright".
        """
        return 1

    # ..................................................................................................................
    # üõ°Ô∏è PHASE 2: –ø–æ–ª–∏—Ç–∏–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è
    # ..................................................................................................................
    def _owner_required(self) -> bool:
        # –ü–∞–Ω–µ–ª—å –Ω–µ –∂–∏–≤—ë—Ç –≤ –≤–∞–∫—É—É–º–µ ‚Äî –≤—Å–µ–≥–¥–∞ –∫—Ç–æ-—Ç–æ –≤–ª–∞–¥–µ–ª–µ—Ü (—Å—Ç—Ä–æ–∫–∞ –≥—Ä–∏–¥–∞, td –≥—Ä–∏–¥–∞, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏ —Ç.–¥.)
        return True

    def _allowed_owner_types(self) -> tuple[type, ...] | None:
        # –ü–∞–Ω–µ–ª—å –º–æ–∂–µ—Ç –≤–∏—Å–µ—Ç—å –Ω–∞ –ª—é–±–æ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ (Grid_Td, Page, CardBody, –∏ —Ç.–¥.),
        # –∞ –æ–Ω–∏ —É –Ω–∞—Å –≤—Å–µ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç TCustomControl / TControl.
        return (TCustomControl,)

    def _allowed_child_types(self) -> tuple[type, ...] | None:
        """
        –ü–∞–Ω–µ–ª—å –≤ –º–æ–º–µ–Ω—Ç —Ä–æ–∂–¥–µ–Ω–∏—è –º–æ–∂–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –≤–ª–∞–¥–µ—Ç—å —á–µ–º —É–≥–æ–¥–Ω–æ –≤–∏–∑—É–∞–ª—å–Ω—ã–º,
        –ø–æ—Ç–æ–º—É —á—Ç–æ TLabel(pnl) —Å–Ω–∞—á–∞–ª–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ø–∞–Ω–µ–ª–∏.
        –ü–æ—Ç–æ–º –º—ã —Å–∞–º–∏ –ø–µ—Ä–µ—Å–∞–∂–∏–≤–∞–µ–º –µ–≥–æ –≤ td(-1).

        –ü–æ—ç—Ç–æ–º—É –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –∏ TFlex_Td (—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏),
        –∏ –ª—é–±–æ–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª.
        """
        return (TFlex_Td, TCustomControl)
# ----------------------------------------------------------------------------------------------------------------------
# üß© TCardPanel ‚Äî –ø–∞–Ω–µ–ª—å –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ (header / footer / status)
# ----------------------------------------------------------------------------------------------------------------------
class TCardPanel(TFlex_Tr):
    prefix = "cpnl"
    MARK_FAMILY = "card"
    MARK_LEVEL = 1
    # ‚ö°üõ†Ô∏è ‚ñ∏ __init__
    def __init__(self, Owner=None, Name: str | None = None):
        """
        –ü–∞–Ω–µ–ª—å –∫–∞—Ä—Ç–æ—á–∫–∏. –ñ–∏–≤—ë—Ç –¢–û–õ–¨–ö–û –≤–Ω—É—Ç—Ä–∏ TCard –∏ –∑–∞–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ä—ã–π TPanel.
        –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–¥–∞—ë—Ç—Å—è self.type:
          ‚Ä¢ "ptHeader" ‚Üí –≤–µ—Ä—Ö –∫–∞—Ä—Ç–æ—á–∫–∏ (–∏–∫–æ–Ω–∫–∞ + title + sub_title + –¥–µ–π—Å—Ç–≤–∏—è —Å–ø—Ä–∞–≤–∞)
          ‚Ä¢ "ptFooter" ‚Üí –Ω–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —Å—Ç–∞—Ç—É—Å–∞
          ‚Ä¢ "ptStatus" ‚Üí –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å-–±–∞—Ä (–º–µ–ª–∫–∏–π —à—Ä–∏—Ñ—Ç)
          ‚Ä¢ "ptNone"   ‚Üí —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –≥–∏–±–∫–∞—è —Å—Ç—Ä–æ–∫–∞
        –í–Ω—É—Ç—Ä–∏ –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Ç—Ä–∏ –∫–æ–ª–æ–Ω–∫–∏ (td):
          left_td  ‚Äî —Å–ª–µ–≤–∞,
          mid_td   ‚Äî —Å–µ—Ä–µ–¥–∏–Ω–∞ (—Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è),
          right_td ‚Äî —Å–ø—Ä–∞–≤–∞.
        """
        super().__init__(Owner, Name)

        # --- –†–æ–ª—å –ø–∞–Ω–µ–ª–∏ ---
        self.type: str = "ptNone"

        # --- –ö–æ–ª–æ–Ω–∫–∏ –ø–∞–Ω–µ–ª–∏ ---
        # –∫–∞–∂–¥–∞—è –∫–æ–ª–æ–Ω–∫–∞ ‚Äî —ç—Ç–æ TFlex_Td, —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å—Ä–∞–∑—É –∏ –∂–∏–≤—ë—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
        self.left_td = self.td()
        self.mid_td = self.td()
        self.right_td = self.td()

        # –ª–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ ‚Äî –∫–æ–Ω—Ç–µ–Ω—Ç —Å–ª–µ–≤–∞ (–∏–∫–æ–Ω–∫–∞+–∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ header)
        self.left_td.add_class("d-flex")
        self.left_td.add_class("align-items-start")
        self.left_td.add_class("gap-2")
        self.left_td.add_class("flex-wrap")

        # —Å—Ä–µ–¥–Ω—è—è –∫–æ–ª–æ–Ω–∫–∞ ‚Äî —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ–º–∞—è –∑–æ–Ω–∞
        self.mid_td.add_class("d-flex")
        self.mid_td.add_class("align-items-center")
        self.mid_td.add_class("flex-grow-1")
        self.mid_td.add_class("gap-2")
        self.mid_td.add_class("flex-wrap")

        # –ø—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ ‚Äî actions —Å–ø—Ä–∞–≤–∞
        self.right_td.add_class("d-flex")
        self.right_td.add_class("align-items-center")
        self.right_td.add_class("gap-2")
        self.right_td.add_class("flex-wrap")
        self.right_td.add_class("ms-auto")

        # ... üîä ...
        self.log("__init__", f"‚öôÔ∏è card-panel {self.Name} created type={self.type}")
        # ‚ö°üõ†Ô∏è TCardPanel ‚ñ∏ End of __init__
    # ..................................................................................................................
    # üîß –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∞–≤—Ç–æ—Å–±–æ—Ä—â–∏–∫ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
    # ..................................................................................................................
    def _auto_header_compose(self):
        """
        –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–ø–æ–ª–Ω—è–µ—Ç —à–∞–ø–∫—É –∫–∞—Ä—Ç–æ—á–∫–∏ (—Ç–∏–ø ptHeader), –µ—Å–ª–∏ –ª–µ–≤—ã–π td –ø—É—Å—Ç–æ–π.
        –°—Ç—Ä–æ–∏–º:
            [ TIcon(icon) ][
                TLabel(h2, title)
                TLabel(span, sub_title) (–µ—Å–ª–∏ –µ—Å—Ç—å)
            ]
        –î–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è —É self.Owner (—ç—Ç–æ TCard): .icon / .title / .sub_title.
        –ï—Å–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —É–∂–µ —Å–∞–º —á—Ç–æ-—Ç–æ –ø–æ–ª–æ–∂–∏–ª –≤ left_td, –º—ã –Ω–µ —Ç—Ä–æ–≥–∞–µ–º.
        """
        from bb_atom_controls import TLabel, TIcon
        if self.type != "ptHeader":
            return

        # —É–∂–µ –µ—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç? –Ω–µ –ª–µ–∑–µ–º
        if getattr(self.left_td, "Flow", []):
            return

        card = getattr(self, "Owner", None)
        if not card:
            return

        icon_txt = getattr(card, "icon", "")
        title_txt = getattr(card, "title", "")
        sub_txt = getattr(card, "sub_title", "")

        # --- ICON ---
        if icon_txt:
            ico = TIcon(self.left_td)
            ico.icon = icon_txt
            ico.size = 20
            ico.h = 0
            self.left_td.add(ico)

        # --- BLOCK: title + sub_title (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ)
        block = TControl(self.left_td, "AutoTitleBlock")
        block.add_class("d-flex")
        block.add_class("flex-column")

        # –ó–∞–≥–æ–ª–æ–≤–æ–∫ (h2)
        lbl_title = TLabel(block, "AutoTitle")
        lbl_title.h = 2
        lbl_title.add_class("card-title")
        lbl_title.add_class("m-0")
        lbl_title.add_style("line-height:1.2; font-size:16px; font-weight:bold; color:#0056b3;")
        if title_txt:
            lbl_title.caption = title_txt
        # –µ—Å–ª–∏ title –ø—É—Å—Ç–æ–π ‚Üí TLabel —Å–∞–º –ø–æ–¥—Å—Ç–∞–≤–∏—Ç —Å–≤–æ—ë Name

        # –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ (–º–µ–ª–∫–∏–π —Å–µ—Ä—ã–π) ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å
        if sub_txt:
            lbl_sub = TLabel(block, "AutoSub")
            lbl_sub.h = 0
            lbl_sub.caption = sub_txt
            lbl_sub.add_style("color:#666; font-size:13px; line-height:1.2;")

        # –ø–æ–ª–æ–∂–∏—Ç—å –±–ª–æ–∫ —Ü–µ–ª–∏–∫–æ–º –≤ –ª–µ–≤—É—é –∫–æ–ª–æ–Ω–∫—É
        self.left_td.add(block)
    # ..................................................................................................................
    # üé® Render
    # ..................................................................................................................
    def render(self):
        """
        –†–µ–Ω–¥–µ—Ä–∏—Ç –ø–∞–Ω–µ–ª—å –∫–∞—Ä—Ç–æ—á–∫–∏.
        1) –µ—Å–ª–∏ —ç—Ç–æ ptHeader ‚Üí –≤—ã–∑—ã–≤–∞–µ–º _auto_header_compose() –¥–ª—è –ª–µ–≤–æ–π –∫–æ–ª–æ–Ω–∫–∏
        2) –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫—É ptStatus (–º–µ–ª–∫–∏–π —Å–µ—Ä—ã–π —Ç–µ–∫—Å—Ç)
        3) –¥–∞–ª—å—à–µ –≤—ã–∑—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä TFlex_Tr (–∫–∞–∂–¥—ã–π td —Å–∞–º –¥–æ—Ä–µ–Ω–¥–µ—Ä–∏—Ç –¥–µ—Ç–µ–π)
        """
        # –∞–≤—Ç–æ–∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è header
        self._auto_header_compose()

        # –º–µ–ª–∫–∏–π —Ç–µ–∫—Å—Ç –¥–ª—è —Å—Ç–∞—Ç—É—Å-–ø–∞–Ω–µ–ª–µ–π
        if self.type == "ptStatus":
            self.add_class("text-muted")
            self.add_class("small")

        # —Ç–µ–ø–µ—Ä—å –æ–±—ã—á–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä flex-—Å—Ç—Ä–æ–∫–∏
        super().render()
    # ..................................................................................................................
    # üîå –•–µ–ª–ø–µ—Ä—ã-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ø—Ä–µ–∂–Ω–∏–º API –ø–∞–Ω–µ–ª–∏
    # ..................................................................................................................
    def add_left(self, item: any):
        """
        –î–æ–±–∞–≤–ª—è–µ—Ç —É–∑–µ–ª –≤ –ª–µ–≤—É—é –∫–æ–ª–æ–Ω–∫—É (–∫–∞–∫ —Ä–∞–Ω—å—à–µ left_items.append()).
        item –º–æ–∂–µ—Ç –±—ã—Ç—å str (—Å—ã—Ä–æ–π html) –∏–ª–∏ TControl.
        """
        self.left_td.add(item)
        return self

    def add_middle(self, item: any):
        """
        –î–æ–±–∞–≤–ª—è–µ—Ç —É–∑–µ–ª –≤ —Å—Ä–µ–¥–Ω—é—é –∫–æ–ª–æ–Ω–∫—É.
        """
        self.mid_td.add(item)
        return self

    def add_right(self, item: any):
        """
        –î–æ–±–∞–≤–ª—è–µ—Ç —É–∑–µ–ª –≤ –ø—Ä–∞–≤—É—é –∫–æ–ª–æ–Ω–∫—É (–æ–±—ã—á–Ω–æ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π).
        """
        self.right_td.add(item)
        return self
    # ..................................................................................................................
    # üî∞ mark* methods
    # ..................................................................................................................
    def _mark_family(self) -> str | None:
        return "card"

    def _mark_level(self) -> int:
        return 1
    # ..................................................................................................................
    # üõ°Ô∏è PHASE 2: –ø–æ–ª–∏—Ç–∏–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è
    # ..................................................................................................................
    def _owner_required(self) -> bool:
        return True  # header/footer –±–µ–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–æ–æ–±—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç

    def _allowed_owner_types(self) -> tuple[type, ...] | None:
        # card.header.Owner -> card
        # card.footer.Owner -> card
        return (TCard,)

    def _allowed_child_types(self) -> tuple[type, ...] | None:
        # header/footer —Å–æ—Å—Ç–æ—è—Ç –∏–∑ –∫–æ–ª–æ–Ω–æ–∫ (left_td, mid_td, right_td),
        # –∫–æ—Ç–æ—Ä—ã–µ —è–≤–ª—è—é—Ç—Å—è TFlex_Td.
        return (TFlex_Td,)
# ----------------------------------------------------------------------------------------------------------------------
# üß© TCardBody ‚Äî –ø–∞–Ω–µ–ª—å —Ç–µ–ª–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ (–±–µ–∑ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞)
# ----------------------------------------------------------------------------------------------------------------------
class TCardBody(TPanel):
    prefix = "card_body"
    MARK_FAMILY = "card"
    MARK_LEVEL = 1
    # ‚ö°üõ†Ô∏è ‚ñ∏ __init__
    def __init__(self, Owner=None, Name: str | None = None):
        """
        –¢–µ–ª–æ –∫–∞—Ä—Ç–æ—á–∫–∏. –ù–∞—Å–ª–µ–¥—É–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏, –Ω–æ:
        - –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–ª–∞—Å—Å 'card-body';
        - —Å—Ä–∞–∑—É –æ—Ç–∫–ª—é—á–∞–µ—Ç placeholder/—Ä–∞–º–∫—É –ø–∞–Ω–µ–ª–∏ –≤ debug;
        - —Å–ª—É–∂–∏—Ç –ø—Ä–∏—ë–º–Ω–∏–∫–æ–º –¥–ª—è –¥–µ—Ç–µ–π, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å Owner=TCard.
        """
        super().__init__(Owner, Name)
        self.add_class("card-body")
        try:
            self._disable_placeholder_if_needed()  # —É–±—Ä–∞—Ç—å auto td0-–ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –∏ –ø—É–Ω–∫—Ç–∏—Ä
        except Exception:
            pass
        self.log("__init__", f"‚öôÔ∏è card-body {self.Name} created")
# ----------------------------------------------------------------------------------------------------------------------
# üß© TCard ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∞ —Å header / body / footer (–±–∞–∑–æ–≤—ã–π –∫–∞—Ä–∫–∞—Å Tradition Core)
# ----------------------------------------------------------------------------------------------------------------------
class TCard(TControl):
    prefix = "card"
    MARK_FAMILY = "card"
    MARK_LEVEL = 0

    def __init__(self, Owner=None, Name: str | None = None):
        super().__init__(Owner, Name)
        self._constructing = True                      # <‚Äî NEW
        self.add_class("card"); self.add_class("shadow-sm")

        self.icon = "üî•"; self.title = self.Name; self.sub_title = ""
        self.body_text_default = "Put your text please"

        self.header = TCardPanel(self, "Header")
        self.header.add_class("card-header")           # <‚Äî keep Tabler role

        self.body = TCardBody(self, "Body")            # <‚Äî exists before using

        self.footer = TCardPanel(self, "Footer")
        self.footer.add_class("card-footer")
        self.footer.add_class("text-muted"); self.footer.add_class("small")

        self._constructing = False                     # <‚Äî NEW
        self.log("__init__", f"‚öôÔ∏è card {self.Name} created")
    # ..................................................................................................................
    # üé® –†–µ–Ω–¥–µ—Ä
    # ..................................................................................................................
    def render(self):
        """
        1) header._render()
        2) body._render()  (–µ—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî –∫–ª–∞–¥—ë–º body_text_default)
        3) footer._render()
        """
        if self.header:
            self.header._render()
            self.Canvas.extend(self.header.Canvas)
        if not self._body_has_content():
            self.body.td().add(self.body_text_default)
        self.body._render()
        self.Canvas.extend(self.body.Canvas)
        if self.footer:
            self.footer._render()
            self.Canvas.extend(self.footer.Canvas)
    # ..................................................................................................................
    # üîß –ü–µ—Ä–µ—Ö–≤–∞—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–µ—Ç–µ–π: –≤—Å—ë –Ω–µ header/body/footer ‚Üí –≤ body
    # ..................................................................................................................
    def add_control(self, ctrl: "TCustomControl"):
        if getattr(self, "_constructing", False) or ctrl in (
                getattr(self, "header", None),
                getattr(self, "body", None),
                getattr(self, "footer", None),
        ):
            return super().add_control(ctrl)

        # –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –≤ body
        if ctrl.Name in self.Components:
            del self.Components[ctrl.Name]
        if hasattr(self, "Controls") and ctrl.Name in self.Controls:
            del self.Controls[ctrl.Name]
        ctrl.Owner = self.body
        self.body.Components[ctrl.Name] = ctrl
        self.body.add_control(ctrl)
    # ..................................................................................................................
    # üîç –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ
    # ..................................................................................................................
    def _body_has_content(self) -> bool:
        for td in getattr(self.body, "Tds", []):
            if getattr(td, "Flow", []):
                return True
        return False
    # ------------------------------------------------------------------------------------------------------------------
    # mark() / debug family hooks
    # ------------------------------------------------------------------------------------------------------------------
    def _mark_family(self) -> str | None:
        # —Å–µ–º–µ–π—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –ø–æ–¥—Å–≤–µ—Ç–∫–µ –∏ –ø–∞–ª–∏—Ç—Ä–µ
        return "card"

    def _mark_level(self) -> int:
        # –∫–∞—Ä—Ç–æ—á–∫–∞ ‚Äî –∫–æ—Ä–Ω–µ–≤–æ–π –æ–±—ä–µ–∫—Ç —Å–≤–æ–µ–≥–æ —Å–µ–º–µ–π—Å—Ç–≤–∞
        return 0

    def _child_mark_level(self) -> int:
        # –µ—ë –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ flex-–ø–∞–Ω–µ–ª–∏ (header/footer –ø–∞–Ω–µ–ª—å–∫–∏) –ø–æ–º–µ—á–∞–µ–º —É—Ä–æ–≤–Ω–µ–º 1
        return 1

    # –ø–æ–ª–∏—Ç–∏–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è (PHASE 2)
    def _owner_required(self) -> bool:
        # Card –≤—Å–µ–≥–¥–∞ —á–µ–π-—Ç–æ —Ä–µ–±—ë–Ω–æ–∫ (—Å—Ç—Ä–∞–Ω–∏—Ü—ã, td, –ø–∞–Ω–µ–ª–∏ –∏ —Ç.–ø.)
        return True

    def _allowed_owner_types(self) -> tuple[type, ...] | None:
        # –ö–∞—Ä—Ç–æ—á–∫–∞ –º–æ–∂–µ—Ç –∂–∏—Ç—å –≤ –ª—é–±–æ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
        # (—è—á–µ–π–∫–∞ –≥—Ä–∏–¥–∞, flex-td, –ø–∞–Ω–µ–ª—å, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏ —Ç.–¥.),
        # –∞ –∑–Ω–∞—á–∏—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–∫–∞–∑–∞—Ç—å "–ª—é–±–æ–π TCustomControl".
        return (TCustomControl,)

    def _allowed_child_types(self) -> tuple[type, ...] | None:
        # –£ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–Ω—É—Ç—Ä–∏ –º–æ–≥—É—Ç –∂–∏—Ç—å:
        #  - –µ—ë —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ header/footer (TCardPanel)
        #  - –∫–æ–Ω—Ç–µ–Ω—Ç–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã (–∫–Ω–æ–ø–∫–∏, –ª–µ–π–±–ª—ã, etc.)
        return (TCustomControl,)
# ======================================================================================================================
# üìÅüåÑ bb_controls.py üúÇ The End ‚Äî See You Next Session 2025 üíπ 188 -> 218 -> 336 -> 814 -> 1191 -> 1755 -> 2088 -> 775
# ======================================================================================================================









