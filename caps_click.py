# ======================================================================================================================
# üìÅ file        : caps_click.py ‚Äî –ê–∫—É—Å—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é CapsLock (Windows)
# üïí created     : 27.10.2025 13:05
# üéâ contains    : CapsLock clicker: —Ö—É–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —á–µ—Ä–µ–∑ pynput, –∑–≤—É–∫ "–ø—É—Ç" –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º CapsLock, main() CLI-—É—Ç–∏–ª–∏—Ç–∞
# üåÖ project     : Tradition Core 2025 üúÇ
# ======================================================================================================================
# üö¢ ...imports...
import ctypes
import winsound
import threading
import os
import time
from pynput import keyboard
# üíé ... CONFIG / CONSTS ...
SOUND_PATH = None  # –ø—É—Ç—å –∫ –∫–∞—Å—Ç–æ–º–Ω–æ–º—É WAV (–ø—Ä–∏–º–µ—Ä: "quiet_click.wav")
BEEP_FREQ_HZ = 700  # —á–∞—Å—Ç–æ—Ç–∞ Beep –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–ì—Ü)
BEEP_DURATION_MS = 15  # –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å Beep (–º—Å), –∫–æ—Ä–æ—Ç–∫–∏–π "—â–µ–ª—á–æ–∫"
MIN_INTERVAL_BETWEEN_CLICKS = 0.00  # –∞–Ω—Ç–∏-—Å–ø–∞–º –º–µ–∂–¥—É –∫–ª–∏–∫–∞–º–∏ (—Å–µ–∫); 0.00 = –∑–≤—É–∫ –Ω–∞ –ö–ê–ñ–î–û–ï —Å–æ–±—ã—Ç–∏–µ
VK_CAPITAL = 0x14  # WinAPI –∫–æ–¥ CapsLock
__all__ = ["is_caps_on", "play_click", "on_press", "main"]
# üíé ... RUNTIME STATE ...
_last_click_time = 0.0
stop_flag = False
# ----------------------------------------------------------------------------------------------------------------------
# üß© CapsLock helpers ‚Äî —á—Ç–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–ª–∞–≤–∏—à–∏ CapsLock (Windows-only)
# ----------------------------------------------------------------------------------------------------------------------
def is_caps_on():
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True –µ—Å–ª–∏ CapsLock –≤–∫–ª—é—á—ë–Ω –Ω–∞ —ç—Ç–æ–π –º–∞—à–∏–Ω–µ.
    Windows-only: —á–∏—Ç–∞–µ—Ç WinAPI GetKeyState(VK_CAPITAL=0x14) —á–µ—Ä–µ–∑ user32.
    """
    return (ctypes.windll.user32.GetKeyState(VK_CAPITAL) & 0x0001) != 0
# ----------------------------------------------------------------------------------------------------------------------
# üß© Sound playback ‚Äî –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —â–µ–ª—á–∫–∞/Beep –ø—Ä–∏ –ø–µ—á–∞—Ç–∏
# ----------------------------------------------------------------------------------------------------------------------
def play_click():
    """
    –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∫–æ—Ä–æ—Ç–∫–∏–π –∑–≤—É–∫ "–ø—É—Ç" –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–ª–∞–≤–∏—à–∏ –ø–æ–¥ –∞–∫—Ç–∏–≤–Ω—ã–º CapsLock.
    –õ–æ–≥–∏–∫–∞:
    - –∞–Ω—Ç–∏-—Å–ø–∞–º —á–µ—Ä–µ–∑ MIN_INTERVAL_BETWEEN_CLICKS;
    - –µ—Å–ª–∏ –∑–∞–¥–∞–Ω SOUND_PATH –∏ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º WAV –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (winsound.SND_ASYNC);
    - –∏–Ω–∞—á–µ –≤—ã–∑—ã–≤–∞–µ–º winsound.Beep(...) –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º daemon-–ø–æ—Ç–æ–∫–µ, —á—Ç–æ–±—ã –Ω–µ —Å—Ç–æ–ø–æ—Ä–∏—Ç—å –≤–≤–æ–¥.
    """
    global _last_click_time
    now = time.time()
    if now - _last_click_time < MIN_INTERVAL_BETWEEN_CLICKS:
        return
    _last_click_time = now
    if SOUND_PATH and os.path.exists(SOUND_PATH):
        winsound.PlaySound(SOUND_PATH, winsound.SND_FILENAME | winsound.SND_ASYNC)
    else:
        threading.Thread(target=lambda: winsound.Beep(BEEP_FREQ_HZ, BEEP_DURATION_MS), daemon=True).start()
# ----------------------------------------------------------------------------------------------------------------------
# üß© Keyboard hook ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏–π –∫–ª–∞–≤–∏—à (pynput.Listener.on_press)
# ----------------------------------------------------------------------------------------------------------------------
def on_press(key):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à–∏.
    –ü–æ–≤–µ–¥–µ–Ω–∏–µ:
    - ESC ‚Üí –º—è–≥–∫–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É (listener.stop()).
    - –ï—Å–ª–∏ CapsLock –≤–∫–ª—é—á—ë–Ω ‚Üí –∏–∑–¥–∞—ë–º —â–µ–ª—á–æ–∫ –¢–û–õ–¨–ö–û –¥–ª—è "—Ä–µ–∞–ª—å–Ω—ã—Ö" —Å–∏–º–≤–æ–ª–æ–≤ (KeyCode).
    - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∫–ª–∞–≤–∏—à–∏ —Ç–∏–ø–∞ Shift/Ctrl/Alt –Ω–µ –æ–∑–≤—É—á–∏–≤–∞—é—Ç—Å—è.
    """
    global stop_flag
    if key == keyboard.Key.esc:
        stop_flag = True
        return False  # –≤–µ—Ä–Ω—ë—Ç False ‚Üí listener.join() –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è
    if is_caps_on():
        # –æ–∑–≤—É—á–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ KeyCode (—Å–∏–º–≤–æ–ª—å–Ω—ã–µ –∫–ª–∞–≤–∏—à–∏), —á—Ç–æ–±—ã Shift/Alt –Ω–µ "–ø—É–∫–∞–ª–∏"
        if isinstance(key, keyboard.KeyCode):
            play_click()
        else:
            # –•–æ—á–µ—à—å —á—Ç–æ–±—ã Enter/Space/Backspace —Ç–æ–∂–µ –∑–≤—É—á–∞–ª–∏? —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–π –Ω–∏–∂–µ ‚¨á
            # if key in (keyboard.Key.enter, keyboard.Key.space, keyboard.Key.backspace):
            #     play_click()
            pass
    return True
# ......................................................................................................................
# üöÄ main() ‚Äî –∑–∞–ø—É—Å–∫ Caps Clicker CLI
# ......................................................................................................................
def main():
    """
    –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ CLI.
    –§—É–Ω–∫—Ü–∏—è:
    - –ø–µ—á–∞—Ç–∞–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é;
    - –∑–∞–ø—É—Å–∫–∞–µ—Ç pynput.Listener –∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ keypress —Å–æ–±—ã—Ç–∏—è;
    - –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ –≤—ã—Ö–æ–¥–∞;
    - –ø–æ ESC –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É –±–µ–∑ —É–±–∏–π—Å—Ç–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–µ –∑–∞–¥–∞—á.
    """
    print("Caps clicker –∑–∞–ø—É—â–µ–Ω.")
    print("  - CapsLock –í–ö–õ => –∫–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª –≥–æ–≤–æ—Ä–∏—Ç '–ø—É—Ç'.")
    print("  - CapsLock –í–´–ö–õ => —Ç–∏—à–∏–Ω–∞.")
    print("  - ESC => –≤—ã—Ö–æ–¥.\n")
    # —Å–ª—É—à–∞—Ç–µ–ª—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (–Ω–∞–º –≤–∞–∂–µ–Ω —Ç–æ–ª—å–∫–æ on_press)
    with keyboard.Listener(on_press=on_press) as listener:
        listener.join()
    print("–í—ã—Ö–æ–¥. –•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è üêç")
if __name__ == "__main__":
    main()
# ======================================================================================================================
# üìÅüåÑ caps_click.py üúÇ The End ‚Äî See You Next Session 2025 üíπ Tradition Core 2025.10
# ======================================================================================================================